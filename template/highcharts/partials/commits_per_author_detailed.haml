- authors = stats.author_stats.to_a.sort{ |a, b| b[1].commits <=> a[1].commits }
- fc = stats.general_stats.first_commit
- lc = stats.general_stats.last_commit

- block(:commits_per_author_detailed,12) do
  - authors.each_with_index do |v,i|
    - days = v[1].daystats.map{|d,s| [d, "Date.UTC(#{d.year},#{d.mon-1},#{d.mday})", s.commits, s.lines_added, s.lines_deleted]}.sort{|a,b| a[0] <=> b[0]}
    - commits_str = "[#{days.map{|v| "[#{v[1]}, #{v[2]}]"}.join(", ")}]"
    - added_lines_str   = "[#{days.map{|v| "[#{v[1]}, #{v[3]}]"}.join(", ")}]"
    - deleted_lines_str = "[#{days.map{|v| "[#{v[1]}, #{v[4]}]"}.join(", ")}]"
    %div.thumbnail.col-md-6
      %h4
        #{v[0].name}
        %br
        %small= v[0].email 
      %h5= v[1].commits
      %div{:id => "chart_commits_per_author_#{i}", :style => "height: 300px; width: 100%"}

      %div.panel.panel-default
        %div.panel-heading{"data-toggle" => "collapse", "data-target" => "#commits_per_author_#{i}_box"}&= label(:activity_per_day)
        %div.panel-body.collapse{:id => "commits_per_author_#{i}_box"}
          %table.table.table-striped.table-hover{:id => "commits_per_author_#{i}_table"}
            %thead
              %tr
                %th Date
                %th Commits
                %th Files added
                %th Files deleted
                %th Lines added
                %th Lines deleted
            %tbody
              - author_daystats = v[1].daystats
              - author_daystats.each do |date, commits|
                %tr
                  %td&= date
                  %td&= commits.commits
                  %td&= commits.files_added
                  %td&= commits.files_deleted
                  %td&= commits.lines_added
                  %td&= commits.lines_deleted
    
    %script
      var chart_commits_per_author_#{i}           = new Object();
      chart_commits_per_author_#{i}.x_min         = Date.UTC(#{fc.year},#{fc.mon-1},#{fc.mday})
      chart_commits_per_author_#{i}.x_max         = Date.UTC(#{lc.year},#{lc.mon-1},#{lc.mday})
      chart_commits_per_author_#{i}.label         = '#{label(:commits_per_author_detailed)}';
      chart_commits_per_author_#{i}.label_y_axis  = "Number of commits";
      chart_commits_per_author_#{i}.label_y2_axis = "Changed lines";
      chart_commits_per_author_#{i}.target        = '#chart_commits_per_author_#{i}';
      chart_commits_per_author_#{i}.series        = [{"name":"Commits","yAxis": 0,"data":#{commits_str}},{"name":"Added lines","color": "#6CC644","yAxis": 1,"data":#{added_lines_str}},{"name":"Deleted lines","color": "#BD2C00","yAxis": 1,"data":#{deleted_lines_str}}];
      chart_commits_per_author_#{i}.legend        = {};
      
      $(document).ready(function() {
      createDateAreaChart(chart_commits_per_author_#{i});
      $("#commits_per_author_#{i}_table").DataTable({
      "order": [[ 0, "asc" ]]
      });
      });
